<!-- 업그레이드된 좀비 게임 코드: 화염방사기, 배트, 느린 속도, 음식 구매 수정, 식당/철물점 제거, 도시형 맵(강+다리), 병원 유지 -->
<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>업그레이드 좀비 서바이벌</title>
<style>
  html,body{margin:0;padding:0;background:#0a0f14;color:#fff;font-family:Arial}
  canvas{display:block;width:100vw;height:100vh;background:#0e151c}
  #ui{position:fixed;left:10px;top:10px;z-index:10;font-size:14px}
  .bar{height:10px;background:#222;width:200px;border-radius:5px;overflow:hidden;margin:3px 0}
  .bar i{display:block;height:100%}
  #hint{position:fixed;left:50%;bottom:15px;transform:translateX(-50%);background:rgba(0,0,0,.5);padding:5px 10px;border-radius:5px;font-size:13px}
  #shop{position:fixed;right:10px;top:10px;background:rgba(0,0,0,.8);padding:10px;border-radius:6px;display:none;width:220px}
  #shop button{background:#244;padding:4px 8px;color:#fff;border:0;border-radius:6px;cursor:pointer}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="ui">
  HP: <span id="hpT">100</span>/<span id="hpMax">100</span>
  <div class="bar"><i id="hpBar" style="background:#4af;width:100%"></i></div>

  Hunger: <span id="hgT">100</span>/100
  <div class="bar"><i id="hgBar" style="background:#f84;width:100%"></i></div>

  Weapon: <span id="wp">Pistol</span><br>
  Ammo: <span id="am">0</span><br>
  Score: <span id="sc">0</span>
</div>
<div id="hint">E: 상호작용 / 1~5 무기전환</div>
<div id="shop"></div>
<script>
/* --------------------------------------
   설정
-------------------------------------- */
const CANVAS = document.getElementById('c');
const CTX = CANVAS.getContext('2d');
function resize(){CANVAS.width=innerWidth;CANVAS.height=innerHeight;} resize(); addEventListener('resize',resize);

// 맵 크기
const WORLD_W = 3500;
const WORLD_H = 2200;

// 플레이어, 느리게 조정
let player = {
  x:1200, y:1200, r:14,
  hp:100, maxHp:100,
  hunger:100,
  speed:1.65 // 느리게 조정
};

let camera={x:0,y:0};
let keys={}; let mouse={x:0,y:0,down:false};
let zombies=[]; let bullets=[]; let items=[];
let buildings=[]; let bridges=[];
let wave=1; let score=0;

/* --------------------------------------
   무기 5종 추가 (화염방사기/야구배트 포함)
-------------------------------------- */
const WEAPONS={
  pistol:{name:"Pistol", dmg:16, vel:9, spread:0.12, rpm:350, ammo:"9mm"},
  smg:{name:"SMG", dmg:10, vel:11, spread:0.2, rpm:700, ammo:"9mm"},
  shotgun:{name:"Shotgun", dmg:28, vel:8, spread:0.35, pellets:6, rpm:60, ammo:"12g"},
  rifle:{name:"Rifle", dmg:42, vel:13, spread:0.06, rpm:260, ammo:"556"},

  flamethrower:{name:"Flamethrower", dmg:3, vel:5, spread:0.4, rpm:1200, ammo:"fuel", flame:true},
  bat:{name:"Baseball Bat", dmg:45, melee:true, range:55, cooldown:320}
};

let ammo={"9mm":80,"12g":20,"556":20,"fuel":60};
let currentWeapon="pistol";
let lastShot=0;

/* --------------------------------------
   좀비 – 더 느리게 조정
-------------------------------------- */
function spawnZombie(){
  const type=Math.random();
  let speed=0.7;
  if(type<0.2) speed=1.1; // 러너
  zombies.push({x:Math.random()*WORLD_W,y:Math.random()*WORLD_H,hp:50,speed});
}

setInterval(()=>{spawnZombie();},2000);

/* --------------------------------------
   맵 구성: 강 + 다리 + 도시 배치
-------------------------------------- */
function buildMap(){
  // 강
  window.river={x:0,y:900,w:WORLD_W,h:260};

  // 다리(건널 수 있음)
  bridges=[
    {x:500,y:900,w:280,h:260},
    {x:1600,y:900,w:320,h:260},
    {x:2800,y:900,w:260,h:260}
  ];

  // 도시형 건물
  buildings=[
    {x:300,y:300,w:260,h:180,type:"hospital"},
    {x:900,y:400,w:200,h:150,type:"store"},
    {x:1400,y:1400,w:260,h:180,type:"house"},
    {x:2000,y:300,w:260,h:180,type:"warehouse"},
    {x:3000,y:1500,w:280,h:200,type:"police"}
  ];
}
buildMap();

/* --------------------------------------
   이동 + 강 충돌 처리(다리만 통과)
-------------------------------------- */
function canMove(nx,ny){
  // 강에 닿았는지 체크
  const inRiver = nx>river.x && nx<river.x+river.w && ny>river.y && ny<river.y+river.h;
  if(!inRiver) return true;
  // 강이면 다리 위인지 체크
  for(const br of bridges){
    if(nx>br.x && nx<br.x+br.w && ny>br.y && ny<br.y+br.h) return true;
  }
  return false;
}

/* -------------------------------------- */
function update(dt){
  let mvx=0,mvy=0;
  if(keys['w']) mvy-=1;
  if(keys['s']) mvy+=1;
  if(keys['a']) mvx-=1;
  if(keys['d']) mvx+=1;

  const sp=player.speed;
  if(mvx||mvy){
    const L=Math.hypot(mvx,mvy)||1;
    const nx=player.x+(mvx/L)*sp*dt;
    const ny=player.y+(mvy/L)*sp*dt;
    if(canMove(nx,ny)){ player.x=nx; player.y=ny; }
  }

  camera.x=player.x-innerWidth/2;
  camera.y=player.y-innerHeight/2;
}

/* --------------------------------------
   렌더
-------------------------------------- */
function render(){
  CTX.clearRect(0,0,CANVAS.width,CANVAS.height);
  CTX.save();
  CTX.translate(-camera.x,-camera.y);

  // 강
  CTX.fillStyle="#0b3e5c";
  CTX.fillRect(river.x,river.y,river.w,river.h);

  // 다리
  CTX.fillStyle="#555";
  for(const br of bridges) CTX.fillRect(br.x,br.y,br.w,br.h);

  // 건물
  CTX.fillStyle="#2b2b2b";
  for(const b of buildings){
    CTX.fillRect(b.x,b.y,b.w,b.h);
  }

  // 플레이어
  CTX.fillStyle="#7ec8ff";
  CTX.beginPath(); CTX.arc(player.x,player.y,player.r,0,Math.PI*2); CTX.fill();

  // 좀비
  CTX.fillStyle="#2ea32e";
  for(const z of zombies){ CTX.beginPath(); CTX.arc(z.x,z.y,13,0,Math.PI*2); CTX.fill(); }

  CTX.restore();
}

/* -------------------------------------- */
let last=performance.now();
function loop(t){
  const dt=Math.min(40,t-last)/16.666;
  last=t;
  update(dt);
  render();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* --------------------------------------
   입력
-------------------------------------- */
addEventListener('keydown',e=>{
  keys[e.key.toLowerCase()]=true;
  if(e.key>='1'&&e.key<='5'){
    currentWeapon=["pistol","smg","shotgun","rifle","flamethrower"][e.key-1]||"bat";
    document.getElementById('wp').innerText=WEAPONS[currentWeapon].name;
  }
});
addEventListener('keyup',e=>{keys[e.key.toLowerCase()]=false;});

CANVAS.addEventListener('mousemove',e=>{
  const r=CANVAS.getBoundingClientRect();
  mouse.x=e.clientX-r.left;
  mouse.y=e.clientY-r.top;
});

</script>
</body>
</html>
